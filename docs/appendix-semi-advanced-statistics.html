<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>14 Appendix: semi-advanced statistics | Introduction To Basic Statistics in R</title>
  <meta name="description" content="This document serves as a simple introduction to some of the basic principles in statistics in R." />
  <meta name="generator" content="bookdown 0.16.1 and GitBook 2.6.7" />

  <meta property="og:title" content="14 Appendix: semi-advanced statistics | Introduction To Basic Statistics in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This document serves as a simple introduction to some of the basic principles in statistics in R." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14 Appendix: semi-advanced statistics | Introduction To Basic Statistics in R" />
  
  <meta name="twitter:description" content="This document serves as a simple introduction to some of the basic principles in statistics in R." />
  

<meta name="author" content="Version 1.1.0" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="appendix-semi-advanced-r.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to Basic Statistics in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="firstlook.html"><a href="firstlook.html"><i class="fa fa-check"></i><b>2</b> First look at R</a></li>
<li class="chapter" data-level="3" data-path="definitions-of-basic-princples.html"><a href="definitions-of-basic-princples.html"><i class="fa fa-check"></i><b>3</b> Definitions of basic princples</a></li>
<li class="chapter" data-level="4" data-path="uncertainty.html"><a href="uncertainty.html"><i class="fa fa-check"></i><b>4</b> Uncertainty</a></li>
<li class="chapter" data-level="5" data-path="distributions-probabilities.html"><a href="distributions-probabilities.html"><i class="fa fa-check"></i><b>5</b> Distributions &amp; Probabilities</a></li>
<li class="chapter" data-level="6" data-path="basic-statistics.html"><a href="basic-statistics.html"><i class="fa fa-check"></i><b>6</b> Basic Statistics</a><ul>
<li class="chapter" data-level="6.1" data-path="basic-statistics.html"><a href="basic-statistics.html#hypotheses-and-the-t-test"><i class="fa fa-check"></i><b>6.1</b> Hypotheses and the T-test</a></li>
<li class="chapter" data-level="6.2" data-path="basic-statistics.html"><a href="basic-statistics.html#anova"><i class="fa fa-check"></i><b>6.2</b> ANOVA</a></li>
<li class="chapter" data-level="6.3" data-path="basic-statistics.html"><a href="basic-statistics.html#correlation"><i class="fa fa-check"></i><b>6.3</b> Correlation</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="probability-values.html"><a href="probability-values.html"><i class="fa fa-check"></i><b>7</b> Probability values</a></li>
<li class="chapter" data-level="8" data-path="the-multiple-testing-problem.html"><a href="the-multiple-testing-problem.html"><i class="fa fa-check"></i><b>8</b> The Multiple Testing Problem</a></li>
<li class="chapter" data-level="9" data-path="power-analysis.html"><a href="power-analysis.html"><i class="fa fa-check"></i><b>9</b> Power Analysis</a></li>
<li class="chapter" data-level="10" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i><b>10</b> Plotting</a><ul>
<li class="chapter" data-level="10.1" data-path="plotting.html"><a href="plotting.html#basics-mapping"><i class="fa fa-check"></i><b>10.1</b> Basics &amp; Mapping</a></li>
<li class="chapter" data-level="10.2" data-path="plotting.html"><a href="plotting.html#types-of-plot"><i class="fa fa-check"></i><b>10.2</b> Types of plot</a></li>
<li class="chapter" data-level="10.3" data-path="plotting.html"><a href="plotting.html#layout-and-style"><i class="fa fa-check"></i><b>10.3</b> Layout and Style</a></li>
<li class="chapter" data-level="10.4" data-path="plotting.html"><a href="plotting.html#themes"><i class="fa fa-check"></i><b>10.4</b> Themes</a></li>
<li class="chapter" data-level="10.5" data-path="plotting.html"><a href="plotting.html#statistics-in-plots"><i class="fa fa-check"></i><b>10.5</b> Statistics in plots</a></li>
<li class="chapter" data-level="10.6" data-path="plotting.html"><a href="plotting.html#norment-options"><i class="fa fa-check"></i><b>10.6</b> NORMENT options</a></li>
<li class="chapter" data-level="10.7" data-path="plotting.html"><a href="plotting.html#more-examples"><i class="fa fa-check"></i><b>10.7</b> More examples</a></li>
<li class="chapter" data-level="10.8" data-path="plotting.html"><a href="plotting.html#repeated-meausures-anova"><i class="fa fa-check"></i><b>10.8</b> Repeated-Meausures ANOVA</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="a-full-analysis-script.html"><a href="a-full-analysis-script.html"><i class="fa fa-check"></i><b>11</b> A Full Analysis Script</a></li>
<li class="chapter" data-level="12" data-path="futher-reading.html"><a href="futher-reading.html"><i class="fa fa-check"></i><b>12</b> Futher Reading</a></li>
<li class="chapter" data-level="13" data-path="appendix-semi-advanced-r.html"><a href="appendix-semi-advanced-r.html"><i class="fa fa-check"></i><b>13</b> Appendix: semi-advanced R</a><ul>
<li class="chapter" data-level="13.1" data-path="appendix-semi-advanced-r.html"><a href="appendix-semi-advanced-r.html#sharing-your-data"><i class="fa fa-check"></i><b>13.1</b> Sharing your data</a></li>
<li class="chapter" data-level="13.2" data-path="appendix-semi-advanced-r.html"><a href="appendix-semi-advanced-r.html#for-loops"><i class="fa fa-check"></i><b>13.2</b> For-loops</a></li>
<li class="chapter" data-level="13.3" data-path="appendix-semi-advanced-r.html"><a href="appendix-semi-advanced-r.html#the-pipe"><i class="fa fa-check"></i><b>13.3</b> The pipe</a></li>
<li class="chapter" data-level="13.4" data-path="appendix-semi-advanced-r.html"><a href="appendix-semi-advanced-r.html#working-with-dates"><i class="fa fa-check"></i><b>13.4</b> Working with dates</a></li>
<li class="chapter" data-level="13.5" data-path="appendix-semi-advanced-r.html"><a href="appendix-semi-advanced-r.html#animations"><i class="fa fa-check"></i><b>13.5</b> Animations</a></li>
<li class="chapter" data-level="13.6" data-path="appendix-semi-advanced-r.html"><a href="appendix-semi-advanced-r.html#cowplot"><i class="fa fa-check"></i><b>13.6</b> Cowplot</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="appendix-semi-advanced-statistics.html"><a href="appendix-semi-advanced-statistics.html"><i class="fa fa-check"></i><b>14</b> Appendix: semi-advanced statistics</a><ul>
<li class="chapter" data-level="14.1" data-path="appendix-semi-advanced-statistics.html"><a href="appendix-semi-advanced-statistics.html#anova-1"><i class="fa fa-check"></i><b>14.1</b> ANOVA</a></li>
<li class="chapter" data-level="14.2" data-path="appendix-semi-advanced-statistics.html"><a href="appendix-semi-advanced-statistics.html#everything-is-a-linear-model"><i class="fa fa-check"></i><b>14.2</b> Everything is a linear model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/norment" target="blank">Created for NORMENT</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction To Basic Statistics in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="appendix-semi-advanced-statistics" class="section level1">
<h1><span class="header-section-number">14</span> Appendix: semi-advanced statistics</h1>
<p>Here I’ll go more in-depth into some concepts I think are important. I’ll probably dive deeper into the process underneath some statistical tests, in particular ANOVA, since it’s so often done misunderstood.</p>
<div id="anova-1" class="section level2">
<h2><span class="header-section-number">14.1</span> ANOVA</h2>
<p>Here I want to go into some of the intricacies of the repeated-measures ANOVA I’ll go through some of the assumptions, and describe the operations underlying the ANOVA. This section is based on an online lecture and tutorial by Andrew Conway. We’ll first calculate every manually, (i.e. sum of squares, mean squares etc.) so that we get the F statistic and the p-value. At the end of this long paragraph, I’ll show how to get the same results in one or two lines of code. But of course the purpose of this paragraph is to lay out some of the underlying statistics beneath ANOVA, as to understand better what the output of any ANOVA is were we to run it like we do commonly. Let’s say we ran a longitudunal study, where we train a group of people to perform a difficult task, which is scored from 0 to 10. The data is stored in a variable called <code>data</code>.</p>
<p>Let’s say we tested 20 individuals, and we investigated how their test scores improved after 8, 12, 17, and 19 days of training. Here’s the summary of the data that we have:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="appendix-semi-advanced-statistics.html#cb183-1"></a><span class="kw">summary</span>(data)</span></code></pre></div>
<pre><code>##        id       condition      score      
##  1      : 4   8 days :20   Min.   :2.700  
##  2      : 4   12 days:20   1st Qu.:5.487  
##  3      : 4   17 days:20   Median :6.325  
##  4      : 4   19 days:20   Mean   :6.408  
##  5      : 4                3rd Qu.:7.562  
##  6      : 4                Max.   :9.600  
##  (Other):56</code></pre>
<p>One of the assumptions of a repeated-measures ANOVA is the assumption of sphericity. Sphericity in this context means that the amount of variance of the differences (i.e difference in test scores) between all possible comparisons of within-subject conditions (i.e. days of training) is equal. We use the Mauchly’s Test to test this assumption. This test is implemented in R as the <code>mauchly.test()</code> fuction. In order to test this assumption, we need a little matrix with the participants along the rows, and the test scores as values inside separate columns. In our case we’ll have a 20 x 4 matrix. Let’s create that with the <code>pivot_wider()</code> function. This takes the condition levels (i.e. the new column names) and adds every level as a column. The score (aka value) is entered as values in these columns. As default, it also carries over the <code>id</code> column, which we dont want, so we deselect it with the <code>select()</code> function, and then we convert it from a data frame to a matrix using the <code>as.matrix()</code> function.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="appendix-semi-advanced-statistics.html#cb185-1"></a>score_matrix &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></span>
<span id="cb185-2"><a href="appendix-semi-advanced-statistics.html#cb185-2"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> condition, <span class="dt">values_from =</span> score) <span class="op">%&gt;%</span></span>
<span id="cb185-3"><a href="appendix-semi-advanced-statistics.html#cb185-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="st">&quot;id&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb185-4"><a href="appendix-semi-advanced-statistics.html#cb185-4"></a><span class="st">  </span><span class="kw">as.matrix</span>()</span></code></pre></div>
<p>Then, since the <code>mauchly.test()</code> function requires a linear model as input, we first need to create that. We take the matrix with the scores, and add it into an <code>lm()</code> function. Since we don’t want to run it against anything else, we run the <code>lm</code> by 1 (which incidentally is equivalent to running a T-test, but that’s a story for another time). Then we add the linear model into the <code>mauchly.test()</code> function, and specify that we ran it against 1 in the <code>x</code> option.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="appendix-semi-advanced-statistics.html#cb186-1"></a>lm_model &lt;-<span class="st"> </span><span class="kw">lm</span>(score_matrix <span class="op">~</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb186-2"><a href="appendix-semi-advanced-statistics.html#cb186-2"></a><span class="kw">mauchly.test</span>(lm_model, <span class="dt">x =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## 
##  Mauchly&#39;s test of sphericity
## 
## data:  SSD matrix from lm(formula = score_matrix ~ 1)
## W = 0.81725, p-value = 0.9407</code></pre>
<p>If the Mauchly test is significant, then we know that our data is significantly different from the assumption of sphericity, we we want a non-signficicant result on this test. In this case, the p-value is 0.9407, which means that we can assume that we meet the assumption of sphericity, and can proceed. If this test would come up significant, then we’d have to add a correction to the futher analysis, typically a Greenhouse-Geisser correction or a Huyn-Feldt correction. The Greenhouse-Geisser correction is incorporated in the <code>{afex}</code> package.</p>
<p>From here, running a repeated measures is quite simple with the functions available in R, but the purpose of this paragraph is to do it manually, so below we’ll calculate the F-ratio ourselves. The first thing we need for this is the variance of the grouping condition, or the between-groups variance. We calculate the sum of squares, which is the number of participants multiplied by the sum of the group mean minus the overall mean, squared. This is easier explained in a formula where y<sub>j</sub> (j stands for the number of levels) is the group mean and the other y is the overall mean across conditions and n is the number of pariticpants.</p>
<p><span class="math display">\[ss_{a} = n\sum (y_{j} - \overline{y})^2\]</span></p>
<p>We can translate this formula to R as follows. In summary, first we determine the number of participants (which we know, but it’s good practice to make it more dynamic). Then we calculate the group means by grouping the data variable and calulating the mean score for each level of the condition. This will give us a data frame with the condition as one column, and the mean score in another column called <code>y_j</code>. Then we calculate the sum of squares by translating the formula above into R code.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="appendix-semi-advanced-statistics.html#cb188-1"></a>n &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(data<span class="op">$</span>id)) <span class="co"># number of participants in dataset</span></span>
<span id="cb188-2"><a href="appendix-semi-advanced-statistics.html#cb188-2"></a>group_means &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-3"><a href="appendix-semi-advanced-statistics.html#cb188-3"></a><span class="st">  </span><span class="kw">group_by</span>(condition) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># group by condition</span></span>
<span id="cb188-4"><a href="appendix-semi-advanced-statistics.html#cb188-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">y_j =</span> <span class="kw">mean</span>(score)) <span class="co"># calculate group means</span></span>
<span id="cb188-5"><a href="appendix-semi-advanced-statistics.html#cb188-5"></a>y_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(group_means<span class="op">$</span>y_j) <span class="co"># calculate mean of group means</span></span>
<span id="cb188-6"><a href="appendix-semi-advanced-statistics.html#cb188-6"></a></span>
<span id="cb188-7"><a href="appendix-semi-advanced-statistics.html#cb188-7"></a>ss_cond &lt;-<span class="st"> </span>n <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>((group_means<span class="op">$</span>y_j <span class="op">-</span><span class="st"> </span>y_mean)<span class="op">^</span><span class="dv">2</span>)</span></code></pre></div>
<p>The sum of squares now represents the systematic between-groups variance. Then we can calculate the mean squares, which represents systematic variance. The formula for this is simply the sum of squares we calculated before divided by the degrees of freedom of the condition, which is the number of levels inside the condition minus one. The formula looks like this:</p>
<p><span class="math display">\[ms_{a} = \frac{ss_{a}}{df_{a}}\]</span></p>
<p>We already calculated the sum of squares, the degree of freedoms is one less than the number of levels inside the condition, so the formula for this in R is simple:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="appendix-semi-advanced-statistics.html#cb189-1"></a>df_cond &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(data<span class="op">$</span>condition)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb189-2"><a href="appendix-semi-advanced-statistics.html#cb189-2"></a>ms_cond &lt;-<span class="st"> </span>ss_cond<span class="op">/</span>df_cond</span></code></pre></div>
<p>The <code>ms_a</code> variable now contains the value that represents the systematic variance based on the condition. Now, since we want to do a repeated-measures ANOVA, we also need to incorporate the error associated with the individual participants that is inevitable when testing them on different time points. So now we’ll do the same we did earlier, but now calculating the sum of squares and mean squares to calculate the variance associated with the participants. We’ll use the same formula, but instead we now use the number of levels in the condition as the <code>n</code>, and the degrees of freedom (<code>df_p</code>) is one less than the number of pariticpants. Notice the differences between the code below and the code above.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="appendix-semi-advanced-statistics.html#cb190-1"></a>n &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(data<span class="op">$</span>condition))</span>
<span id="cb190-2"><a href="appendix-semi-advanced-statistics.html#cb190-2"></a>participant_means &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb190-3"><a href="appendix-semi-advanced-statistics.html#cb190-3"></a><span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># group by participant</span></span>
<span id="cb190-4"><a href="appendix-semi-advanced-statistics.html#cb190-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">y_j =</span> <span class="kw">mean</span>(score)) <span class="co"># calculate group means</span></span>
<span id="cb190-5"><a href="appendix-semi-advanced-statistics.html#cb190-5"></a>y_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(participant_means<span class="op">$</span>y_j) <span class="co"># calculate mean of participant means</span></span>
<span id="cb190-6"><a href="appendix-semi-advanced-statistics.html#cb190-6"></a></span>
<span id="cb190-7"><a href="appendix-semi-advanced-statistics.html#cb190-7"></a>ss_p &lt;-<span class="st"> </span>n <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>((participant_means<span class="op">$</span>y_j <span class="op">-</span><span class="st"> </span>y_mean)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb190-8"><a href="appendix-semi-advanced-statistics.html#cb190-8"></a></span>
<span id="cb190-9"><a href="appendix-semi-advanced-statistics.html#cb190-9"></a>df_p &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(data<span class="op">$</span>id)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb190-10"><a href="appendix-semi-advanced-statistics.html#cb190-10"></a>ms_p &lt;-<span class="st"> </span>ss_p<span class="op">/</span>df_p</span></code></pre></div>
<p>We now have the systematic variance due to participants, this will serve as the error term later on. Now we also need to think about the unsystematic variance in the data. This is the unsystematic within-group variance. We calculate the mean score by group and then subtract that from the individual scores.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="appendix-semi-advanced-statistics.html#cb191-1"></a>data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></span>
<span id="cb191-2"><a href="appendix-semi-advanced-statistics.html#cb191-2"></a><span class="st">  </span><span class="kw">group_by</span>(condition) <span class="op">%&gt;%</span></span>
<span id="cb191-3"><a href="appendix-semi-advanced-statistics.html#cb191-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">meany_i =</span> <span class="kw">mean</span>(score))</span></code></pre></div>
<p>Then we calculate the within-groups sum of squares and the mean squares like we did before. The degrees of freedom in this case is the number of levels (the exact number, not one less!) multiplied by the number of pariticpants minus one.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="appendix-semi-advanced-statistics.html#cb192-1"></a>ss_pa &lt;-<span class="st"> </span><span class="kw">sum</span>((data<span class="op">$</span>score <span class="op">-</span><span class="st"> </span>data<span class="op">$</span>meany_i)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb192-2"><a href="appendix-semi-advanced-statistics.html#cb192-2"></a></span>
<span id="cb192-3"><a href="appendix-semi-advanced-statistics.html#cb192-3"></a>df &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(data<span class="op">$</span>condition)) <span class="op">*</span><span class="st"> </span>(<span class="kw">length</span>(<span class="kw">unique</span>(data<span class="op">$</span>id)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb192-4"><a href="appendix-semi-advanced-statistics.html#cb192-4"></a>ms_sa &lt;-<span class="st"> </span>ss_pa<span class="op">/</span>df</span></code></pre></div>
<p>But then we still don’t have the unsystematic variance for the error term, but we do have all the ingredients. In order to calculate this, we simply subtract the systematic variance between participants from the between-groups sum of squares. And then we can use that to calculate the mean squares for this, commonly referred to as the error term. The degrees of freedom in this formula is equal to the number of levels in the condition minus one multiplied by the number of participants minus one.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="appendix-semi-advanced-statistics.html#cb193-1"></a>ss_rm &lt;-<span class="st"> </span>ss_pa <span class="op">-</span><span class="st"> </span>ss_p</span>
<span id="cb193-2"><a href="appendix-semi-advanced-statistics.html#cb193-2"></a></span>
<span id="cb193-3"><a href="appendix-semi-advanced-statistics.html#cb193-3"></a>df_error &lt;-<span class="st"> </span>(<span class="kw">length</span>(<span class="kw">unique</span>(data<span class="op">$</span>condition)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(<span class="kw">length</span>(<span class="kw">unique</span>(data<span class="op">$</span>id)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb193-4"><a href="appendix-semi-advanced-statistics.html#cb193-4"></a>ms_rm &lt;-<span class="st"> </span>ss_rm<span class="op">/</span>df_error</span></code></pre></div>
<p>Now we have all the ingredients to calculate the F-ratio, which is the test statistic of the ANOVA. In order to calculate the effect of the condition on the overall variance, we divide the mean squares of the condition by the mean squares of the mean squares of the error term. In formula form it would look like this:</p>
<p><span class="math display">\[F = \frac{mean\ squares\ of\ condition\ (ms_{a})}{Error\ term\ (ms_{rm})}\]</span></p>
<p>The R code for this is simple again. To calculate whether the condition has a significant effect on the test score, we use the F distribution function (<code>pf()</code>), which takes the F ratio, and the degrees of freedom of both the numerator and the denominator. The output from this function is the distribution function, we get the p-value by substracting this distribution function from 1. The code for this looks something like this:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="appendix-semi-advanced-statistics.html#cb194-1"></a>F_ratio &lt;-<span class="st"> </span>ms_cond<span class="op">/</span>ms_rm</span>
<span id="cb194-2"><a href="appendix-semi-advanced-statistics.html#cb194-2"></a></span>
<span id="cb194-3"><a href="appendix-semi-advanced-statistics.html#cb194-3"></a>p &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pf</span>(F_ratio, df_cond, df_error)</span>
<span id="cb194-4"><a href="appendix-semi-advanced-statistics.html#cb194-4"></a><span class="kw">print</span>(p)</span></code></pre></div>
<pre><code>## [1] 2.159436e-06</code></pre>
<p>We find that there is a significant effect of the condition on the subject variance! In human language, the length of training affected test scores significantly. This was a lot of hassle with idenitical code coming by several times in perhaps somewhat confusing variable names. Luckily for us, we don’t need to do this every time. In the main text we’ve used the <code>aov()</code> function already. We can use it here to but add the error term in the <code>Error()</code> function and incorporate it into the formula that goes into the <code>aov()</code>. Let’s do all that we’ve done above again, but in two lines:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="appendix-semi-advanced-statistics.html#cb196-1"></a>repmeas_model &lt;-<span class="st"> </span><span class="kw">aov</span>(score <span class="op">~</span><span class="st"> </span>condition <span class="op">+</span><span class="st"> </span><span class="kw">Error</span>(id<span class="op">/</span>condition), <span class="dt">data =</span> data)</span>
<span id="cb196-2"><a href="appendix-semi-advanced-statistics.html#cb196-2"></a><span class="kw">summary</span>(repmeas_model)</span></code></pre></div>
<pre><code>## 
## Error: id
##           Df Sum Sq Mean Sq F value Pr(&gt;F)
## Residuals 19   43.9   2.311               
## 
## Error: id:condition
##           Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## condition  3  49.02  16.341   12.51 2.16e-06 ***
## Residuals 57  74.45   1.306                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>If you have followed along with the code and looked at the values of each variable we calculated (e.g. <code>ss_p</code>), you might now notice that the last “Residuals” part of the output represents the error term. The values on the <code>condition</code> row is identical to the between-group variance we calculated, and the F-value and p-value are equal to the output we obtained manually!</p>
<p>Of course in regular analysis scripts, you would pick the <code>aov()</code> over all the hassle we went through earlier, but the purpose of this paragraph was just to become more familiar with the underlying operations of ANOVA.</p>
</div>
<div id="everything-is-a-linear-model" class="section level2">
<h2><span class="header-section-number">14.2</span> Everything is a linear model</h2>
<p>Since this requires a rather elaborate description, I’ve made a separate article on this topic. It is still work in progress, but the preliminary version can be found <a href="http://www.danielroelfs.com/everythingisalinearmodel/" target="_blank">here</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="appendix-semi-advanced-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": false,
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
